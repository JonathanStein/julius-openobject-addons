<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        
        <!-- Tree View Editable for Periods in contract -->
        <record model="ir.ui.view" id="view_period_tree"> 
            <field name="name">period.contract.tree</field>
            <field name="model">period.contract</field>
            <field name="arch" type="xml">
                <tree string="period" editable="top">
                    <field name="name"/>
                    <field name="from_dt" required="1"/>
                    <field name="to_dt" required="1"/>
                    <field name="guaranteed"/>
                </tree>
            </field>
        </record>

		<!-- Form View contract -->
        <record id="view_account_analytic_account_form_inherit" model="ir.ui.view">
            <field name="name">account.analytic.account.form.inherit</field>
            <field name="model">account.analytic.account</field>
            <field name="inherit_id" ref="analytic.view_account_analytic_account_form"/>
            <field name="arch" type="xml">
                <field name="parent_id" position="replace">
                    <field name="parent_id" required="1"/>
                </field>
                <field name="type" position="after">
                    <field name="active"/>
                    <field name="is_a_contract"/>
                </field>
                <field name="code" position="replace">
                	<field name="code" readonly="1"/>
                </field>
                <field name="partner_id" position="replace">
                	<field name="partner_id"/>
                </field>
                <!--<field name="contact_id" position="replace">
                    <field name="contact_id" domain="[('partner_id','=',partner_id)]"/>
                </field>-->
                <field name="date_start" position="replace"/>
                <field name="date" position="replace">
                    <field name="client_num"/>
                    <field name="sap_number"/>
                    <field name="payment_term_id"/>
                </field>
                <page string="Contract Information" position="after">
            		<page string="Periods">
            			<field name="period_ids" nolabel="1"/>
            		</page>
            		<page string="Invoices">
            			<field name="invoice_ids" nolabel="1"/>
            		</page>
            		<page string="Products">
            			<field name="product_ids" nolabel="1">
                            <tree>                    
                                <field name="default_code"/>                
                                <field name="name"/>   
                                <field name="list_price"/>
                                <field name="standard_price"/>
                                <field name="uom_id"/>
                                <field name="active" invisible="1"/>
                            </tree>
                            <form string="Product">
                               <group colspan="4" col="8">
	                                <group colspan="4" col="2">
	                                    <separator string="Name" colspan="2"/>
	                                    <field name="name"/>
	                                    <field groups="product.group_product_variant" name="variants" />
	                                </group>
	                                <group colspan="1" col="2">
	                                    <separator string="Codes" colspan="2"/>
	                                    <field name="default_code"/>
	                                    <field name="ean13" groups="base.group_extended"/>
	                                </group>
	                                <group colspan="1" col="2">
	                                    <separator string="Characteristics" colspan="2"/>
	                                    <field name="sale_ok"/>
	                                    <field name="purchase_ok"/>
	                                </group>
	                                <group colspan="1" col="1">
	                                    <!--<field name="product_image" widget='image' nolabel="1"/>-->
	                                </group> 
                                </group>
                                <notebook colspan="4">
                                    <page string="Information">
                                        <group colspan="2" col="2">
                                            <separator string="Procurement" colspan="2"/>
                                            <field name="type"/>
                                            <field name="procure_method" groups="base.group_extended"/>
                                            <field name="supply_method"/>
                                        </group>
                                        <group colspan="2" col="2">
                                            <separator string="Base Prices" colspan="2"/>
                                            <field name="list_price"/>
                                            <field groups="base.group_extended" name="cost_method"/>
                                            <field name="standard_price" attrs="{'readonly':[('cost_method','=','average')]}"
                                                groups="base.group_extended"/>
                                            <newline/>
                                            <field name="price_margin" groups="product.group_product_variant"/>
                                            <field name="price_extra" groups="product.group_product_variant"/>
                                        </group>
            
                                        <group colspan="2" col="2" groups="base.group_extended">
                                            <separator string="Weights" colspan="2"/>
                                            <field digits="(14, 3)" name="volume" attrs="{'readonly':[('type','=','service')]}"/>
                                            <field name="weight" attrs="{'readonly':[('type','=','service')]}"/>
                                            <field name="weight_net" attrs="{'readonly':[('type','=','service')]}"/>
                                        </group>
            
                                        <group colspan="2" col="2" name="status" groups="base.group_extended">
                                            <separator string="Status" colspan="2"/>
                                            <field name="categ_id"/>
                                            <field name="state"/>
                                            <field name="product_manager"/>
                                        </group>
            
                                        <group colspan="2" col="2" name="uom">
                                            <separator string="Unit of Measure" colspan="2"/>
                                            <field name="uom_id" on_change="onchange_uom(uom_id,uom_po_id)"/>
                                            <field name="uom_po_id" groups="base.group_extended"/>
                                        </group>
            
                                        <group colspan="2" col="2" name="uos" groups="product.group_uos">
                                            <separator string="Second UoM" colspan="2"/>
                                            <field name="uos_id"/>
                                            <field name="uos_coeff"/>
                                            <field name="mes_type"/>
                                        </group>
            
                                    </page>
                                    <page string="Procurement &amp; Locations">
                                        <group colspan="2" col="2" name="delay">
                                            <separator string="Delays" colspan="2"/>
                                            <field name="sale_delay" attrs="{'readonly':[('sale_ok','=',0)]}"/>
                                            <field name="produce_delay"/>
                                            <field name="warranty"/>
                                        </group>
                                        <group colspan="2" col="2" name="store">
                                            <separator string="Storage Localisation" colspan="2"/>
                                            <field name="loc_rack" attrs="{'readonly':[('type','=','service')]}" />
                                            <field name="loc_row" attrs="{'readonly':[('type','=','service')]}"/>
                                            <field name="loc_case" attrs="{'readonly':[('type','=','service')]}"/>
                                        </group>
            
                                        <group colspan="2" col="2" name="misc" groups="base.group_extended">
                                            <separator string="Miscellaneous" colspan="2"/>
                                            <field name="active"/>
                                            <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                                        </group>
            
                                    </page>
                                    <page string="Suppliers">
                                        <field colspan="4" name="seller_ids" nolabel="1" context="{'uom_id': uom_id}"/>
                                    </page>
                                    <page string="Descriptions">
                                        <separator string="Description"/>
                                        <field colspan="4" name="description" nolabel="1"/>
                                        <separator string="Sale Description"/>
                                        <field colspan="4" name="description_sale" nolabel="1"/>
                                        <separator string="Purchase Description"/>
                                        <field colspan="4" name="description_purchase" nolabel="1"/>
                                    </page>
                                    <page groups="base.group_extended" string="Packaging">
                                        <field colspan="4" name="packaging" nolabel="1">
                                            <form string="Packaging">
                                                <field name="ean"/>
                                                <field name="sequence" invisible="1"/>
                                                <newline/>
                                                <field name="qty"/>
                                                <field name="ul"/>
                                                <field name="weight_ul"/>
                                                <separator colspan="4" string="Palletization"/>
                                                <field name="ul_qty"/>
                                                <field name="rows"/>
                                                <field name="weight"/>
                                                <separator colspan="4" string="Pallet Dimension"/>
                                                <field name="height"/>
                                                <field name="width"/>
                                                <field name="length"/>
                                                <separator colspan="4" string="Description"/>
                                                <field colspan="4" name="name" nolabel="1"/>
                                            </form>
                                        </field>
                                    </page>
                                    <page string="Accounting">
					                    <group name="properties" groups="base.group_extended">
					                        <separator string="Sales Properties" colspan="2"/>
					                        <separator string="Purchase Properties" colspan="2"/>
					                        <field name="property_account_income" domain="[('type','&lt;&gt;','view'),('type','&lt;&gt;','consolidation')]" attrs="{'readonly':[('sale_ok','=',0)]}"  groups="base.group_extended"/>
					                        <field name="property_account_expense" domain="[('type','&lt;&gt;','view'),('type','&lt;&gt;','consolidation')]" attrs="{'readonly':[('purchase_ok','=',0)]}"  groups="base.group_extended"/>
										</group>
										<newline/>
										<group colspan="2">
					                        <separator string="Sale Taxes" colspan="2"/>
					                        <separator string="Purchase Taxes" colspan="2"/>
					                        <field name="taxes_id" nolabel="1" colspan="2" attrs="{'readonly':[('sale_ok','=',0)]}"/>
					                        <field name="supplier_taxes_id" nolabel="1" colspan="2" attrs="{'readonly':[('purchase_ok','=',0)]}"/>
					                    </group>
				                    </page>
                            		<page string="Certificate" groups="base_certificate.group_certificate_user,base_certificate.group_certificate_manager">
                  						<field name="type_ids" colspan="4" nolabel="1" widget="many2many" mode="tree,form"/>
                					</page>
                                </notebook>
                            </form>
                        </field>
            		</page>
                </page>
            </field>
        </record>
        <record id="view_account_analytic_account_form_inherit_2" model="ir.ui.view">
            <field name="name">account.analytic.account.form.inherit</field>
            <field name="model">account.analytic.account</field>
            <field name="inherit_id" ref="hr_timesheet_invoice.account_analytic_account_form_form"/>
            <field name="arch" type="xml">
                <field name="state" position="attributes">
                	<attribute name="invisible">1</attribute>
				</field>
                <button name="set_cancel" position="attributes">
                	<attribute name="invisible">1</attribute>
				</button>
                <button name="set_open" position="attributes">
                	<attribute name="invisible">1</attribute>
				</button>                
				<button name="set_pending" position="attributes">
                	<attribute name="invisible">1</attribute>
				</button>                
				<button name="set_close" position="attributes">
                	<attribute name="invisible">1</attribute>
				</button>            
			</field>
        </record>
        <!--<record id="view_account_analytic_account_form_inherit_3" model="ir.ui.view">
            <field name="name">account.analytic.account.form.inherit</field>
            <field name="model">account.analytic.account</field>
            <field name="inherit_id" ref="hr_timesheet.account_analytic_account_form_form"/>
            <field name="arch" type="xml">
                <page string="Invoice Analysis" position="replace"/>
                <page string="Stats by month" position="replace"/>
                <page string="Stats by user" position="replace"/>
            </field>
        </record>-->
        

	    <!-- Invoice -->
        <record id="view_account_invoice_form_inherit" model="ir.ui.view">
            <field name="name">account.invoice.form.inherit</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
				<field name="name" position="before">
            		<field name="contract_id" domain="[('is_a_contract','=',True)]" on_change="onchange_contract_id(contract_id)"/>
                </field>
                <field name="invoice_line" position="replace">
                   	<field colspan="4" name="invoice_line" nolabel="1" widget="one2many_list" context="{'type': type,'active_id':active_id}">
                   		<form string="Invoice Lines">
					    	<field name="product_id" 
                                    domain="[('contract_id','=',account_analytic_id)]" 
                                    on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, context, parent.company_id)" 
                                    context="{'default_active': False, 'active_test': False}"/>               		
		                    <field colspan="2" name="name"/>
		                    <label string="Quantity :" align="1.0"/>
		                    <group colspan="1" col="2">
		                        <field name="quantity" nolabel="1"/>
		                        <field name="uos_id" on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, context, parent.company_id)" nolabel="1"/>
		                    </group>
		                    <field name="price_unit"/>
		                    <field domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id" on_change="onchange_account_id(product_id, parent.partner_id, parent.type, parent.fiscal_position,account_id)"/>
		                    <field name="asset_category_id"/>
		                    <field name="discount" groups="base.group_extended"/>
		                    <field domain="[('type','&lt;&gt;','view'), ('company_id', '=', parent.company_id), ('parent_id', '!=', False)]" name="account_analytic_id" groups="analytic.group_analytic_accounting"/>
		                    <field name="company_id" groups="base.group_multi_company" readonly="1"/>
		                    <separator string="Notes" colspan="4"/>
		                    <!---<field colspan="4" name="note" nolabel="1"/>-->
		                    <separator colspan="4" string="Taxes"/>
		                    <field colspan="4" name="invoice_line_tax_id" context="{'type':parent.type}" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]" nolabel="1"/>
                   		</form>
                   	</field>
				</field>
            </field>
        </record>  
        <record id="view_account_invoice_filter_inherit" model="ir.ui.view">
            <field name="name">account.invoice.form.inherit</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.view_account_invoice_filter"/>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <field name="period_id" position="after">
                    <field name="contract_id"/>
                </field>
            </field>
        </record>
        <!-- Product -->
        <record id="view_product_product_form_inherit" model="ir.ui.view">
            <field name="name">product.product.form.inherit</field>
            <field name="model">product.product</field>
            <field name="inherit_id" ref="stock.view_normal_property_acc_form"/>
            <field name="arch" type="xml">
				<separator string="Inventory Valuation" position="before">
            		<field name="contract_id" domain="[('is_a_contract','=',True)]" group="contract_customer_invoice.group_contract_manager"/>
                </separator>
                <field name="list_price" position="replace">
                    <field name="list_price" attrs="{'invisible':[('contract_id','!=',False)]}"/>
                </field>
                <field name="standard_price" position="replace">
                    <field name="standard_price" nolabel="1" attrs="{'invisible':[('contract_id','!=',False)],'readonly':[('cost_method','=','average')]}" groups="base.group_extended"/>
                </field>
            </field>
        </record>
		
    </data>
</openerp>
