<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
        
		<!-- 
		""""""""""""""""""""
		Stock Production Lot 
		""""""""""""""""""""
		-->
		<record id="prod_view_prod_lot_form" model="ir.ui.view">
            <field name="name">stock.production.lot.form.inherit</field>
            <field name="model">stock.production.lot</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_production_lot_form"/>
            <field name="arch" type="xml">
                <page string="Stock Moves" position="after">
                	<page string="Certificates">
                    	<group col="2" colspan="4">
	                        <group col="2" colspan="2">
	                        	<separator colspan="2" string="Certificate"/>
                                <field name="certificate_ids" widget="one2many" mode="tree" nolabel="1" colspan="4" domain="[('active', '=', True)]">
                                	<tree>
                                		<field name="name"/>
                                		<field name="template_id" domain="[('object_id.model','=','stock.production.lot')]"/> 
                						<field name="date_obtained"/>
										<field name="validity"/>
										<field name="time_unit"/>
        								<field name="expiry_date"/>
        								<field name="state"/>
        								<field name="prodlot_id" on_change="onchange_prodlot(prodlot_id)"/>
                                	</tree>
					                <form string="Certificate">
					                    <field name="name"/>
					                    <field name="template_id" on_change="onchange_template_id(template_id)" domain="[('object_id.model','=','stock.production.lot')]"/>
						                <field name="date_obtained"/>
										<field name="validity"/>
										<field name="time_unit"/>
						        		<field name="expiry_date"/>
						        		<field name="state"/>
					            		<field name="prodlot_id" on_change="onchange_prodlot(prodlot_id)"/>
					            		<newline/>
					            		<button name="check_documents" string="Documents" colspan="2" type="object"/>
					                </form>
                                </field>
                            </group>
                        </group>
					</page>          
                </page>
            </field>
        </record>
        
    	<!-- 
		""""""""""""""
		Certificate 
		""""""""""""""
		-->
		<record id="product_view_certificate_category_search" model="ir.ui.view">
            <field name="name">certificate.search</field>
            <field name="model">certificate</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
	            <search string="Certificate">
	                <field name="name"/>
                    <field name="template_id" on_change="onchange_template_id(template_id)" domain="[('object_id.model','=','stock.production.lot')]"/>
	                <field name="date_obtained"/>
					<field name="validity"/>
					<field name="time_unit"/>
	        		<field name="expiry_date"/>
	        		<field name="state"/>
            		<field name="prodlot_id" on_change="onchange_prodlot(prodlot_id)"/>
        			<field name="tracking_id"/>
            		<newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Certificate Template" icon="terp-partner" domain="[]" context="{'group_by':'template_id'}"/>
                        <filter string="State"  icon="terp-personal" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Production Lot" icon="terp-partner" domain="[]" context="{'group_by':'prodlot_id'}"/>
                        <filter string="Pack" icon="terp-partner" domain="[]" context="{'group_by':'tracking_id'}"/>
                    </group>
                </search>
            </field>
        </record>
		
		<record id="prod_view_certificate_category_form" model="ir.ui.view">
            <field name="name">certificate.form</field>
            <field name="model">certificate</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Certificate">
                    <field name="name"/>
                    <field name="template_id" on_change="onchange_template_id(template_id)" domain="[('object_id.model','=','stock.production.lot')]"/>
	                <field name="date_obtained"/>
					<field name="validity"/>
					<field name="time_unit"/>
	        		<field name="expiry_date"/>
	        		<field name="state"/>
            		<field name="prodlot_id"/>
                </form>
            </field>
        </record>

        <record id="prod_view_certificate_category_tree" model="ir.ui.view">
            <field name="name">certificate.tree</field>
            <field name="model">certificate</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Certificate List">
                    <field name="name"/>
                    <field name="template_id" domain="[('object_id.model','=','stock.production.lot')]"/>
	                <field name="date_obtained"/>
					<field name="validity"/>
					<field name="time_unit"/>
	        		<field name="expiry_date"/>
	        		<field name="state"/>
            		<field name="prodlot_id" on_change="onchange_prodlot(prodlot_id)"/>
        			<field name="tracking_id" invisible="1"/>
                </tree>
            </field>
        </record>
        
         <record id="prod_open_view_category_form" model="ir.actions.act_window">
            <field name="name">Certificate</field>
            <field name="res_model">certificate</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="prod_view_certificate_category_tree"/>
            <field name="search_view_id" ref="product_view_certificate_category_search"/>
            <field name="context" eval="{'object_id': ref('model_stock_production_lot')}"/>
            <field name="domain">[('object_id.model', '=', 'stock.production.lot')]</field>
        </record>
        <record id="certif_open_view_tree" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="prod_view_certificate_category_tree"/>
            <field name="act_window_id" ref="prod_open_view_category_form"/>
        </record>
        <record id="certif_open_view_form" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="prod_view_certificate_category_form"/>
            <field name="act_window_id" ref="prod_open_view_category_form"/>
        </record>
        
		<menuitem action="prod_open_view_category_form" id="prod_menu_view_certificate_category_for" parent="stock.menu_product_in_config_stock" sequence="60"/>
		
        <!-- 
		"""""""""""""""""""""
		Certificate Template
		"""""""""""""""""""""
		-->
		
        <record id="prod_certificate_type_form_view" model="ir.ui.view">
            <field name="name">certificate.template.tree</field>
            <field name="model">certificate.template</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
            	<form string="Certificate Template">
                    <field name="name"/>
                    <field name="parent_id"/>
                    <field name="survey_id"/>
                    <field name="score_min"/>
                    <field name="score_max"/>
                    <field name="validity"/>
					<field name="time_unit"/>
                    <button name="product_update_certificate_template" string="Update Certificates" colspan="4" type="object"/> 
                    <notebook colspan="4">
                    	<page string="Certificate List">
		                    <field name="certificate_ids" colspan="4" nolabel="1">
			                    <tree string="Certificate List">
			                    	<field name="name"/>
					                <field name="date_obtained"/>
									<field name="validity"/>
									<field name="time_unit"/>
					        		<field name="expiry_date"/>
					        		<field name="state"/>
					        		<field name="prodlot_id" on_change="onchange_prodlot(prodlot_id)"/>
        							<field name="tracking_id" invisible="1"/>
			                	</tree>
				                <form string="Certificate">
				                    <field name="name"/>
				                    <field name="template_id" on_change="onchange_template_id(template_id)" domain="[('object_id.model','=','stock.production.lot')]"/>
					                <field name="date_obtained"/>
									<field name="validity"/>
									<field name="time_unit"/>
					        		<field name="expiry_date"/>
					        		<field name="state"/>
				            		<field name="prodlot_id" on_change="onchange_prodlot(prodlot_id)"/>
        							<field name="tracking_id" invisible="1"/>
				                </form>
		                    </field>
                    	</page>
                    	<page string="Products List">
	                		<field name="product_ids" colspan="4" nolabel="1">
				    			<tree string="Products List">
				     				<field name="name"/>
				      			</tree>
			           		</field>
	                    </page>
	                	<page string="Evaluations">
	                		<field name="survey_response_ids" colspan="4" nolabel="1">
			                    <tree string="Evaluations">
			                    	<field name="survey_id"/>
			                    	<field name="date_create"/>
			                    	<field name="user_id"/>
			                    	<field name="state"/>
			                    </tree>
			                </field>
	                	</page>
                    </notebook>
                </form>
            </field>
        </record>  
        
        <record id="prod_certificate_type_tree" model="ir.ui.view">
            <field name="name">product.certificate.template.tree</field>
            <field name="model">certificate.template</field>
            <field name="type">tree</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Certificate Template">
                    <field name="complete_name"/>
                </tree>
            </field>
        </record>

        <record id="prod_open_view_categ_form" model="ir.actions.act_window">
            <field name="name">Certificate Template</field>
            <field name="res_model">certificate.template</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="prod_certificate_type_tree"/>
            <field name="context" eval="{'object_id': ref('model_stock_production_lot')}"/>
            <field name="domain">[('object_id.model', '=', 'stock.production.lot')]</field>
        </record>
        <record id="prod_open_view_tree" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="prod_certificate_type_tree"/>
            <field name="act_window_id" ref="prod_open_view_categ_form"/>
        </record>
        <record id="prod_open_view_form" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="prod_certificate_type_form_view"/>
            <field name="act_window_id" ref="prod_open_view_categ_form"/>
        </record>

        <menuitem action="prod_open_view_categ_form" id="prod_menu_view_certificate_type_for" parent="stock.menu_product_in_config_stock" sequence="20"/>

        <record id="prod_base_certificate_normal_action_tree" model="ir.actions.act_window">
            <field name="name">Certificate</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">certificate</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('certificate_ids','=', active_ids)]</field>
        </record>

        <record id="prod_base_certificate_category_open" model="ir.values">
            <field eval="'tree_but_open'" name="key2"/>
            <field ref="model_certificate_template" name="model_id"/>
            <field name="model">certificate.template</field>
            <field name="name">Certificate Template</field>
            <field eval="'ir.actions.act_window,%d'%prod_base_certificate_normal_action_tree" name="value"/>
        </record>
        
        <!-- DASHBOARD -->
        
        <record id="prod_open_view_team_category_form" model="ir.actions.act_window">
            <field name="name">Categories of Certificate</field>
            <field name="res_model">certificate</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', '=', 'close'),('object_id.model','=','stock.production.lot')]</field>
        </record>
        
       	<record id="prod_open_view_user_category_form" model="ir.actions.act_window">
            <field name="name">Categories of Certificate</field>
            <field name="res_model">certificate</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', '=', 'close'),('object_id.model','=','stock.production.lot')]</field>
        </record>
        
        <record id="prod_board_certificate_form" model="ir.ui.view">
            <field name="name">board.certificate.form</field>
            <field name="model">board.board</field>
            <field name="inherit_id" ref="stock.board_warehouse_form"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/board/column[1]" position="inside">
                    <action name="%(prod_open_view_user_category_form)d" string="Expired Certificate" />
                </xpath>
	      	</field>
	     </record>
	    
	</data>
</openerp>
